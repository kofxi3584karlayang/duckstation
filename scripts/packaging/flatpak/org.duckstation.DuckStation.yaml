# SPDX-FileCopyrightText: 2019-2025 Connor McLaughlin <stenzek@gmail.com>
# SPDX-License-Identifier: CC-BY-NC-ND-4.0

app-id: "org.duckstation.DuckStation"
runtime: "org.freedesktop.Platform"
runtime-version: "24.08"
sdk: "org.freedesktop.Sdk"
sdk-extensions:
  - "org.freedesktop.Sdk.Extension.llvm19"

command: "duckstation-qt"

finish-args:
  - "--device=all"
  - "--allow=bluetooth"
  - "--share=network"
  - "--share=ipc"
  - "--socket=pulseaudio"
  - "--talk-name=org.freedesktop.ScreenSaver"
  - "--socket=wayland"
  - "--socket=fallback-x11"

modules:
  - name: duckstation
    buildsystem: simple
    sources:
      - type: file
        path: DuckStation.AppImage
    build-options:
      # Don't mess with binaries.
      strip: false
      no-debuginfo: true
    build-commands:
      - "chmod +x DuckStation.AppImage"
      - "./DuckStation.AppImage --appimage-extract"
      - "mv squashfs-root/usr/* \"${FLATPAK_DEST}/\""
      - "rm -fr squashfs-root"
